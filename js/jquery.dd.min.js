// MSDropDown - jquery.dd.js
// author: Marghoob Suleman - Search me on google
// Date: 12th Aug, 2009, {18 Dec, 2010 (2.36)}
// Version: 2.37 {date: 17 June, 2011}
// Revision: 33
// web: www.giftlelo.com | www.marghoobsuleman.com
/*
// msDropDown is free jQuery Plugin: you can redistribute it and/or modify
// it under the terms of the either the MIT License or the Gnu General Public License (GPL) Version 2
*/
(function($){var msOldDiv="",dd=function(element,options){var sElement=element,$this=this,options=$.extend({height:120,visibleRows:7,rowHeight:23,showIcon:!0,zIndex:9999,mainCSS:"dd",useSprite:!1,animStyle:"slideDown",onInit:"",style:""},options);this.ddProp=new Object;var oldSelectedValue="",actionSettings={insideWindow:!0,keyboardAction:!1,currentKey:null},ddList=!1,config={postElementHolder:"_msddHolder",postID:"_msdd",postTitleID:"_title",postTitleTextID:"_titletext",postChildID:"_child",postAID:"_msa",postOPTAID:"_msopta",postInputID:"_msinput",postArrowID:"_arrow",postInputhidden:"_inp"},styles={dd:options.mainCSS,ddTitle:"ddTitle",arrow:"arrow",ddChild:"ddChild",ddTitleText:"ddTitleText",disabled:.3,ddOutOfVision:"ddOutOfVision",borderTop:"borderTop",noBorderTop:"noBorderTop",selected:"selected"},attributes={actions:"focus,blur,change,click,dblclick,mousedown,mouseup,mouseover,mousemove,mouseout,keypress,keydown,keyup",prop:"size,multiple,disabled,tabindex"};this.onActions=new Object;var elementid=$(sElement).prop("id");(void 0===elementid||elementid.length<=0)&&(elementid="msdrpdd"+$.msDropDown.counter++,$(sElement).attr("id",elementid));var inlineCSS=$(sElement).prop("style");options.style+=null==inlineCSS?"":inlineCSS;var allOptions=$(sElement).children();ddList=$(sElement).prop("size")>1||1==$(sElement).prop("multiple"),ddList&&(options.visibleRows=$(sElement).prop("size"));var a_array={},currentP=0,isFilter=!1,oldHeight,cacheElement={},getElement=function(e){return void 0===cacheElement[e]&&(cacheElement[e]=document.getElementById(e)),cacheElement[e]},getPostID=function(e){return elementid+config[e]},getOptionsProperties=function(e){return $(e).prop("style")},matchIndex=function(e){var t=$("#"+elementid+" option:selected");if(t.length>1){for(var s=0;s<t.length;s++)if(e==t[s].index)return!0}else if(1==t.length&&t[0].index==e)return!0;return!1},createA=function(e,t,s,i){var n="",o=getPostID("opt"==i?"postOPTAID":"postAID"),l="opt"==i?o+"_"+t+"_"+s:o+"_"+t,d="",a="";0!=options.useSprite?a=" "+options.useSprite+" "+e.className:d=0==(d=$(e).prop("title")).length?"":'<img src="'+d+'" align="absmiddle" /> ';var r=$(e).text(),p=$(e).val(),c=1==$(e).prop("disabled")?"disabled":"enabled";a_array[l]={html:d+r,value:p,text:r,index:e.index,id:l};var u=getOptionsProperties(e);return 1==matchIndex(e.index)?n+='<a href="javascript:void(0);" class="'+styles.selected+" "+c+a+'"':n+='<a  href="javascript:void(0);" class="'+c+a+'"',!1!==u&&void 0!==u&&(n+=" style='"+u+"'"),n+=' id="'+l+'">',n+=d+'<span class="'+styles.ddTitleText+'">'+r+"</span></a>"},in_array=function(e){var t=e.toLowerCase();if(0==t.length)return-1;var s="";for(var i in a_array){a_array[i].text.toLowerCase().substr(0,t.length)==t&&(s+="#"+a_array[i].id+", ")}return""==s?-1:s},createATags=function(){var e=allOptions;if(0==e.length)return"";var t="";getPostID("postAID"),getPostID("postOPTAID");return e.each((function(s){var i=e[s];if("OPTGROUP"==i.nodeName){t+="<div class='opta'>",t+="<span style='font-weight:bold;font-style:italic; clear:both;'>"+$(i).prop("label")+"</span>";var n=$(i).children();n.each((function(e){var i=n[e];t+=createA(i,s,e,"opt")})),t+="</div>"}else t+=createA(i,s,"","")})),t},createChildDiv=function(){getPostID("postID");var e=getPostID("postChildID"),t=options.style;return sDiv="",sDiv+='<div id="'+e+'" class="'+styles.ddChild+'"',sDiv+=ddList?""!=t?' style="border-top:1px solid #c3c3c3;display:block;position:relative;'+t+'"':"":""!=t?' style="'+t+'"':"",sDiv+=">",sDiv},createTitleDiv=function(){var e=getPostID("postTitleID"),t=getPostID("postArrowID"),s=getPostID("postTitleTextID"),i=(getPostID("postInputhidden"),""),n="";getElement(elementid).options.length>0&&(i=$("#"+elementid+" option:selected").text(),n=$("#"+elementid+" option:selected").prop("title")),n=0==n.length||null==n||0==options.showIcon||0!=options.useSprite?"":'<img src="'+n+'" align="absmiddle" /> ';var o='<div id="'+e+'" class="'+styles.ddTitle+'"';return o+=">",o+='<span id="'+t+'" class="'+styles.arrow+'"></span><span class="'+styles.ddTitleText+'" id="'+s+'">'+n+'<span class="'+styles.ddTitleText+'">'+i+"</span></span></div>"},applyEventsOnA=function(){var e=getPostID("postChildID");$("#"+e+" a.enabled").unbind("click"),$("#"+e+" a.enabled").bind("click",(function(t){if(t.preventDefault(),manageSelection(this),setValue(),!ddList){$("#"+e).unbind("mouseover"),setInsideWindow(!1);var s=0==options.showIcon?$(this).text():$(this).html();setTitleText(s),$this.close()}}))},createDropDown=function(){var e=!1,t=getPostID("postID"),s=getPostID("postTitleID"),i=(getPostID("postTitleTextID"),getPostID("postChildID")),n=(getPostID("postArrowID"),$("#"+elementid).width());n+=2;var o=options.style;$("#"+t).length>0&&($("#"+t).remove(),e=!0);var l='<div id="'+t+'" class="'+styles.dd+'"';if(l+=""!=o?' style="'+o+'"':"",l+=">",l+=createTitleDiv(),l+=createChildDiv(),l+=createATags(),l+="</div>",l+="</div>",1==e){var d=getPostID("postElementHolder");$("#"+d).after(l)}else $("#"+elementid).after(l);if(ddList){s=getPostID("postTitleID");$("#"+s).hide()}if($("#"+t).css("width",n+"px"),$("#"+i).css("width",n-2+"px"),allOptions.length>options.visibleRows){var a=parseInt($("#"+i+" a:first").css("padding-bottom"))+parseInt($("#"+i+" a:first").css("padding-top")),r=options.rowHeight*options.visibleRows-a;$("#"+i).css("height",r+"px")}else if(ddList){r=$("#"+elementid).height();$("#"+i).css("height",r+"px")}0==e&&(setOutOfVision(),addRefreshMethods(elementid)),1==$("#"+elementid).prop("disabled")&&$("#"+t).css("opacity",styles.disabled),applyEvents(),$("#"+s).bind("mouseover",(function(e){hightlightArrow(1)})),$("#"+s).bind("mouseout",(function(e){hightlightArrow(0)})),applyEventsOnA(),$("#"+i+" a.disabled").css("opacity",styles.disabled),ddList&&$("#"+i).bind("mouseover",(function(e){actionSettings.keyboardAction||(actionSettings.keyboardAction=!0,$(document).bind("keydown",(function(e){var t=e.keyCode;actionSettings.currentKey=t,39!=t&&40!=t||(e.preventDefault(),e.stopPropagation(),next(),setValue()),37!=t&&38!=t||(e.preventDefault(),e.stopPropagation(),previous(),setValue())})))})),$("#"+i).bind("mouseout",(function(e){setInsideWindow(!1),$(document).unbind("keydown"),actionSettings.keyboardAction=!1,actionSettings.currentKey=null})),$("#"+s).bind("click",(function(e){setInsideWindow(!1),1==$("#"+i+":visible").length?$("#"+i).unbind("mouseover"):($("#"+i).bind("mouseover",(function(e){setInsideWindow(!0)})),$this.open())})),$("#"+s).bind("mouseout",(function(e){setInsideWindow(!1)})),options.showIcon&&0!=options.useSprite&&setTitleImageSprite()},getByIndex=function(e){for(var t in a_array)if(a_array[t].index==e)return a_array[t];return-1},manageSelection=function(e){var t=getPostID("postChildID");1==$("#"+t+" a."+styles.selected).length&&(oldSelectedValue=$("#"+t+" a."+styles.selected).text()),ddList||$("#"+t+" a."+styles.selected).removeClass(styles.selected);var s=$("#"+t+" a."+styles.selected).prop("id");if(null!=s)var i=null==actionSettings.oldIndex||null==actionSettings.oldIndex?a_array[s].index:actionSettings.oldIndex;if(e&&!ddList&&$(e).addClass(styles.selected),ddList){var n=actionSettings.currentKey;if(1==$("#"+elementid).prop("multiple"))if(17==n)actionSettings.oldIndex=a_array[$(e).prop("id")].index,$(e).toggleClass(styles.selected);else if(16==n){$("#"+t+" a."+styles.selected).removeClass(styles.selected),$(e).addClass(styles.selected);for(var o=$(e).prop("id"),l=a_array[o].index,d=Math.min(i,l);d<=Math.max(i,l);d++)$("#"+getByIndex(d).id).addClass(styles.selected)}else $("#"+t+" a."+styles.selected).removeClass(styles.selected),$(e).addClass(styles.selected),actionSettings.oldIndex=a_array[$(e).prop("id")].index;else $("#"+t+" a."+styles.selected).removeClass(styles.selected),$(e).addClass(styles.selected),actionSettings.oldIndex=a_array[$(e).prop("id")].index}},addRefreshMethods=function(e){var t=e;getElement(t).refresh=function(e){$("#"+t).msDropDown(options)}},setInsideWindow=function(e){actionSettings.insideWindow=e},getInsideWindow=function(){return actionSettings.insideWindow},applyEvents=function(){for(var e=getPostID("postID"),t=attributes.actions.split(","),s=0;s<t.length;s++){var i=t[s];if(1==has_handler(i))switch(i){case"focus":$("#"+e).bind("mouseenter",(function(e){getElement(elementid).focus()}));break;case"click":$("#"+e).bind("click",(function(e){$("#"+elementid).trigger("click")}));break;case"dblclick":$("#"+e).bind("dblclick",(function(e){$("#"+elementid).trigger("dblclick")}));break;case"mousedown":$("#"+e).bind("mousedown",(function(e){$("#"+elementid).trigger("mousedown")}));break;case"mouseup":$("#"+e).bind("mouseup",(function(e){$("#"+elementid).trigger("mouseup")}));break;case"mouseover":$("#"+e).bind("mouseover",(function(e){$("#"+elementid).trigger("mouseover")}));break;case"mousemove":$("#"+e).bind("mousemove",(function(e){$("#"+elementid).trigger("mousemove")}));break;case"mouseout":$("#"+e).bind("mouseout",(function(e){$("#"+elementid).trigger("mouseout")}))}}},setOutOfVision=function(){var e=getPostID("postElementHolder");$("#"+elementid).after("<div class='"+styles.ddOutOfVision+"' style='height:0px;overflow:hidden;position:absolute;' id='"+e+"'></div>"),$("#"+elementid).appendTo($("#"+e))},setTitleText=function(e){var t=getPostID("postTitleTextID");$("#"+t).html(e)},navigateA=function(e){var t,s=e,i=getPostID("postChildID"),n=$("#"+i+" a:visible"),o=n.length,l=$("#"+i+" a:visible").index($("#"+i+" a.selected:visible"));switch(s){case"next":l<o-1&&(t=n[++l]);break;case"previous":l<o&&l>0&&(t=n[--l])}if(void 0===t)return!1;$("#"+i+" a."+styles.selected).removeClass(styles.selected),$(t).addClass(styles.selected);var d=t.id;if(!ddList){var a=0==options.showIcon?a_array[d].text:$("#"+d).html();setTitleText(a),setTitleImageSprite(a_array[d].index)}"next"==s?parseInt($("#"+d).position().top+$("#"+d).height())>=parseInt($("#"+i).height())&&$("#"+i).scrollTop($("#"+i).scrollTop()+$("#"+d).height()+$("#"+d).height()):parseInt($("#"+d).position().top+$("#"+d).height())<=0&&$("#"+i).scrollTop($("#"+i).scrollTop()-$("#"+i).height()-$("#"+d).height())},setTitleImageSprite=function(e){if(0!=options.useSprite){var t=getPostID("postTitleTextID"),s=void 0===e?getElement(elementid).selectedIndex:e,i=getElement(elementid).options[s].className;if(i.length>0){var n=getPostID("postChildID"),o=$("#"+n+" a."+i).prop("id"),l=$("#"+o).css("background-image"),d=$("#"+o).css("background-position"),a=$("#"+o).css("padding-left");null!=l&&$("#"+t).find("."+styles.ddTitleText).attr("style","background:"+l),null!=d&&$("#"+t).find("."+styles.ddTitleText).css("background-position",d),null!=a&&$("#"+t).find("."+styles.ddTitleText).css("padding-left",a),$("#"+t).find("."+styles.ddTitleText).css("background-repeat","no-repeat"),$("#"+t).find("."+styles.ddTitleText).css("padding-bottom","2px")}}},setValue=function(){var e=getPostID("postChildID"),t=$("#"+e+" a."+styles.selected);if(1==t.length){$("#"+e+" a."+styles.selected).text();if(null!=(i=$("#"+e+" a."+styles.selected).prop("id"))){a_array[i].value;getElement(elementid).selectedIndex=a_array[i].index}options.showIcon&&0!=options.useSprite&&setTitleImageSprite()}else if(t.length>1)for(var s=0;s<t.length;s++){var i=$(t[s]).prop("id"),n=a_array[i].index;getElement(elementid).options[n].selected="selected"}var o=getElement(elementid).selectedIndex;$this.ddProp.selectedIndex=o},has_handler=function(e){if(null!=$("#"+elementid).prop("on"+e))return!0;var t=$("#"+elementid).data("events");return!(!t||!t[e])},checkMethodAndApply=function(){var e=getPostID("postChildID");if(1==has_handler("change")){var t=a_array[$("#"+e+" a.selected").prop("id")].text;$.trim(oldSelectedValue)!==$.trim(t)&&""!==oldSelectedValue&&$("#"+elementid).trigger("change")}1==has_handler("mouseup")&&$("#"+elementid).trigger("mouseup"),1==has_handler("blur")&&$(document).bind("mouseup",(function(e){$("#"+elementid).focus(),$("#"+elementid)[0].blur(),setValue(),$(document).unbind("mouseup")}))},hightlightArrow=function(e){var t=getPostID("postArrowID");1==e?$("#"+t).css({backgroundPosition:"0 100%"}):$("#"+t).css({backgroundPosition:"0 0"})},setOriginalProperties=function(){for(var e in getElement(elementid))"function"!=typeof getElement(elementid)[e]&&void 0!==getElement(elementid)[e]&&null!==getElement(elementid)[e]&&$this.set(e,getElement(elementid)[e],!0)},setValueByIndex=function(e,t){if(-1!=getByIndex(t)){getElement(elementid)[e]=t;var s=getPostID("postChildID");$("#"+s+" a."+styles.selected).removeClass(styles.selected),$("#"+getByIndex(t).id).addClass(styles.selected);var i=getByIndex(getElement(elementid).selectedIndex).html;setTitleText(i)}},addRemoveFromIndex=function(e,t){if("d"==t)for(var s in a_array)if(a_array[s].index==e){delete a_array[s];break}var i=0;for(var s in a_array)a_array[s].index=i,i++},shouldOpenOpposite=function(){var e=getPostID("postChildID"),t=getPostID("postID"),s=$("#"+t).position(),i=$("#"+t).height(),n=$(window).height(),o=$(window).scrollTop(),l=$("#"+e).height(),d={zIndex:options.zIndex,top:s.top+i+"px",display:"none"},a=options.animStyle,r=!1,p=styles.noBorderTop;if($("#"+e).removeClass(styles.noBorderTop),$("#"+e).removeClass(styles.borderTop),n+o<Math.floor(l+i+s.top)){var c=s.top-l;s.top-l<0&&(c=10),d={zIndex:options.zIndex,top:c+"px",display:"none"},a="show",r=!0,p=styles.borderTop}return{opp:r,ani:a,css:d,border:p}},fireOpenEvent=function(){null!=$this.onActions.onOpen&&eval($this.onActions.onOpen)($this)},fireCloseEvent=function(){checkMethodAndApply(),null!=$this.onActions.onClose&&eval($this.onActions.onClose)($this)};this.next=function(){navigateA("next")},this.previous=function(){navigateA("previous")},this.open=function(){if(1!=$this.get("disabled",!0)&&0!=$this.get("options",!0).length){var e=getPostID("postChildID");if(""!=msOldDiv&&e!=msOldDiv&&($("#"+msOldDiv).slideUp("fast"),$("#"+msOldDiv).css({zIndex:"0"})),$(".dd").css("display","block"),"none"==$("#"+e).css("display")){oldSelectedValue=a_array[$("#"+e+" a.selected").prop("id")].text;var t="";oldHeight=$("#"+e).height(),$("#"+e+" a").show(),$(document).bind("keydown",(function(s){var i=s.keyCode;switch(8==i&&(s.preventDefault(),s.stopPropagation(),t=0==t.length?"":t.substr(0,t.length-1)),i){case 39:case 40:s.preventDefault(),s.stopPropagation(),next();break;case 37:case 38:s.preventDefault(),s.stopPropagation(),previous();break;case 27:case 13:$this.close(),setValue();break;default:i>46&&(t+=String.fromCharCode(i));var n=in_array(t);if(-1!=n){$("#"+e).css({height:"auto"}),$("#"+e+" a").hide(),$(n).show();var o=shouldOpenOpposite();$("#"+e).css(o.css),$("#"+e).css({display:"block"})}else $("#"+e+" a").show(),$("#"+e).css({height:oldHeight+"px"})}1==has_handler("keydown")&&getElement(elementid).onkeydown()})),$(document).bind("keyup",(function(e){null!=$("#"+elementid).prop("onkeyup")&&getElement(elementid).onkeyup()})),$(document).bind("mouseup",(function(e){0==getInsideWindow()&&$this.close()}));var s=shouldOpenOpposite();$("#"+e).css(s.css),1==s.opp?($("#"+e).css({display:"block"}),$("#"+e).addClass(s.border),fireOpenEvent()):$("#"+e)[s.ani]("fast",(function(){$("#"+e).addClass(s.border),fireOpenEvent()})),e!=msOldDiv&&(msOldDiv=e)}}},this.close=function(){var e=getPostID("postChildID"),t=$("#"+getPostID("postTitleID")).position().top,s=shouldOpenOpposite();isFilter=!1,1==s.opp?$("#"+e).animate({height:0,top:t},(function(){$("#"+e).css({height:oldHeight+"px",display:"none"}),fireCloseEvent()})):$("#"+e).slideUp("fast",(function(t){fireCloseEvent(),$("#"+e).css({zIndex:"0"}),$("#"+e).css({height:oldHeight+"px"})})),setTitleImageSprite(),$(document).unbind("keydown"),$(document).unbind("keyup"),$(document).unbind("mouseup"),$(".dd").css("display","none")},this.selectedIndex=function(e){if(void 0===e)return $this.get("selectedIndex");$this.set("selectedIndex",e)},this.debug=function(e){void 0===e||1==e?$("."+styles.ddOutOfVision).removeAttr("style"):$("."+styles.ddOutOfVision).attr("style","height:0px;overflow:hidden;position:absolute")},this.set=function(e,t,s){if(null==e||null==t)throw{message:"set to what?"};if($this.ddProp[e]=t,1!=s)switch(e){case"selectedIndex":setValueByIndex(e,t);break;case"disabled":$this.disabled(t,!0);break;case"multiple":if(getElement(elementid)[e]=t,ddList=$(sElement).prop("size")>0||1==$(sElement).prop("multiple")){var i=$("#"+elementid).height(),n=getPostID("postChildID");$("#"+n).css("height",i+"px");var o=getPostID("postTitleID");$("#"+o).hide();n=getPostID("postChildID");$("#"+n).css({display:"block",position:"relative"}),applyEventsOnA()}break;case"size":if(getElement(elementid)[e]=t,0==t&&(getElement(elementid).multiple=!1),ddList=$(sElement).prop("size")>0||1==$(sElement).prop("multiple"),0==t){o=getPostID("postTitleID");$("#"+o).show();n=getPostID("postChildID");$("#"+n).css({display:"none",position:"absolute"});var l="";if(getElement(elementid).selectedIndex>=0){var d=getByIndex(getElement(elementid).selectedIndex);l=d.html,manageSelection($("#"+d.id))}setTitleText(l)}else{o=getPostID("postTitleID");$("#"+o).hide();n=getPostID("postChildID");$("#"+n).css({display:"block",position:"relative"})}break;default:try{getElement(elementid)[e]=t}catch(e){}}},this.get=function(e,t){return null==e&&null==t?$this.ddProp:null!=e&&null==t?null!=$this.ddProp[e]?$this.ddProp[e]:null:null!=e&&null!=t?getElement(elementid)[e]:void 0},this.visible=function(e){var t=getPostID("postID");if(1==e)$("#"+t).show();else{if(0!=e)return $("#"+t).css("display");$("#"+t).hide()}},this.add=function(e,t){var s=e,i=s.text,n=null==s.value||null==s.value?i:s.value,o=null==s.title||null==s.title?"":s.title,l=null==t||null==t?getElement(elementid).options.length:t;getElement(elementid).options[l]=new Option(i,n),""!=o&&(getElement(elementid).options[l].title=o);var d=getByIndex(l);if(-1!=d){var a=createA(getElement(elementid).options[l],l,"","");$("#"+d.id).html(a)}else{a=createA(getElement(elementid).options[l],l,"","");var r=getPostID("postChildID");$("#"+r).append(a),applyEventsOnA()}},this.remove=function(e){if(getElement(elementid).remove(e),-1!=getByIndex(e)&&($("#"+getByIndex(e).id).remove(),addRemoveFromIndex(e,"d")),0==getElement(elementid).length)setTitleText("");else{var t=getByIndex(getElement(elementid).selectedIndex).html;setTitleText(t)}$this.set("selectedIndex",getElement(elementid).selectedIndex)},this.disabled=function(e,t){getElement(elementid).disabled=e;var s=getPostID("postID");1==e?($("#"+s).css("opacity",styles.disabled),$this.close()):0==e&&$("#"+s).css("opacity",1),1!=t&&$this.set("disabled",e)},this.form=function(){return null==getElement(elementid).form?null:getElement(elementid).form},this.item=function(){if(1==arguments.length)return getElement(elementid).item(arguments[0]);if(2==arguments.length)return getElement(elementid).item(arguments[0],arguments[1]);throw{message:"An index is required!"}},this.namedItem=function(e){return getElement(elementid).namedItem(e)},this.multiple=function(e){if(void 0===e)return $this.get("multiple");$this.set("multiple",e)},this.size=function(e){if(void 0===e)return $this.get("size");$this.set("size",e)},this.addMyEvent=function(e,t){$this.onActions[e]=t},this.fireEvent=function(nm){eval($this.onActions[nm])($this)};var updateCommonVars=function(){$this.set("version",$.msDropDown.version),$this.set("author",$.msDropDown.author)},init=function(){createDropDown(),setOriginalProperties(),updateCommonVars(),""!=options.onInit&&eval(options.onInit)($this)};init()};$.msDropDown={version:2.37,author:"Marghoob Suleman",counter:20,create:function(e,t){return $(e).msDropDown(t).data("dd")}},$.fn.extend({msDropDown:function(e){return this.each((function(){var t=new dd(this,e);$(this).data("dd",t)}))}}),void 0===$.fn.prop&&($.fn.prop=function(e){return $(this).attr(e)})})(jQuery);